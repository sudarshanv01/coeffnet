# Coefficient Matrix 

We are interested in learning the absolute value of the coefficients of the molecular orbital, $\mathbf{C}$ (also sometimes referred to as the coefficient matrix) generated by solving the eigenvalue problem, 

$$
\mathbf{F}\mathbf{C} = \mathbf{\epsilon} \mathbf{S}\mathbf{C}
$$

where $\mathbf{F}$ is the Fock matrix, $\mathbf{S}$ is the overlap matrix and $\epsilon$ are the eigenvalues for the molecular orbitals. 

```{admonition} Code compatability
Currently we enable parsing and learning of these matrix quantities only for [QChem](https://www.q-chem.com/), which is an electronic structure code which operates in localized basis. Future versions of `minimal-basis` may be extended to include different electronic structure codes.
```

## Converting to orthonormal basis

We will learn the coefficient matrix when all basis functions are made orthogonal to each other. The reason we prefer to learn the coefficient matrix in an orthonormal basis is the sum of squares of each row and column normalize to 1. These constraints on the values that the learnt coefficient matrix can take allow us to include inductive bias in our machine learning model. 

To convert $\mathbf{C}$ from the non-orthonormal basis in which it was computed (through the electronic structure code) to an orthonormal basis, we compute the orthogonalization matrix, $\mathbf{S}^{-1/2}$, 

$$
\mathbf{S}^{-1/2} = \Lambda \lambda^{-1/2} \tilde{\Lambda}
$$

where $\Lambda$ are the eigenvectors and $\lambda$ are the eigenvalues of $\mathbf{S}$ and the tilde refers to the transpose of a matrix. The orthogonal Fock matrix, $\mathbf{F}^\prime$ is generated using $\mathbf{S}^{-1/2}$, 

$$
\mathbf{F}^\prime = \tilde{\mathbf{S}}^{-1/2} \mathbf{F} \mathbf{S}^{-1/2}.
$$

Diagonalising $\mathbf{F}^\prime$ gives the coefficient matrix in orthonormal basis, $\mathbf{C}^\prime$. 

$$
\mathbf{F}^\prime \mathbf{C}^\prime = \epsilon \mathbf{C}^\prime
$$


## Converting to minimal basis 

Often a very large basis set is used for production-quality dataset. These large-basis sets consist of many polarization functions, which may not be required to be learnt by the machine-learning model. In order to trim the size of the matrix to the smallest value, we convert the coefficient matrix from the full-basis representation to the minimal-basis representation.

```{admonition} Note
There are many conflicting definitions of what constitutes a minimal-basis. In this package, we will use all the _s_ and _p_ orbitals and remove any _d_ or higher orbitals from $\mathbf{C}$. This choice is arbitrary, though it is well-suited to study small organic molecules. We expect future versions of the code to lift this requirement and allow arbitrary definitions of the minimal-basis representation.
```

We use the _direct projection_ method to convert the coefficient matrix from the basis in which it was computed to the minimal basis. We define a projector, $\mathbf{B}$,

$$
\mathbf{B} = \braket{\phi_\alpha|\Psi_i}
$$

where $\phi_\alpha$ is an atomic-orbital in the minimal-basis presentation $\left( 1\leq \alpha \leq \mathrm{N}_{\mathrm{Basis}}^\prime \right)$ and $\Psi_i$ is a molecular orbital computed in the full-basis representation $\left( 1 \leq i \leq \mathrm{N}_{\mathrm{basis}} \right)$, $\mathrm{N}_{\mathrm{Basis}}^\prime$ is the total number of basis in the minimal-basis representation and $\mathrm{N}_{\mathrm{Basis}}$ is the number of basis in the full-basis representation.

Since the molecular orbitals are represented as a sum of atomic orbitals, 

$$\Psi_i = \sum \limits_\beta^{\mathrm{N}_{\mathrm{Basis}}} \mathbf{C_{i\beta}} \phi_\beta$$

and hence,

$$
\mathbf{B} = \sum \limits_\beta^{\mathrm{N}_{\mathrm{Basis}}} \mathbf{C_{i\beta}} \braket{\phi_\alpha | \phi_\beta}
$$

$\braket{\phi_\alpha | \phi_\beta}$ is nothing but the overlap matrix generated, removing rows where orbitals in the minimal-basis do not exist. 